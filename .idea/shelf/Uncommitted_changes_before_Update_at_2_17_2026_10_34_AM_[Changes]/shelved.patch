Index: lib/actions/finnhub.actions.ts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>'use server';\r\n\r\nimport { getDateRange, validateArticle, formatArticle } from '@/lib/utils';\r\nimport { POPULAR_STOCK_SYMBOLS } from '@/lib/constants';\r\n\r\nconst FINNHUB_BASE_URL = 'https://finnhub.io/api/v1';\r\nconst FINNHUB_API_KEY = process.env.FINNHUB_API_KEY ?? '';\r\n\r\nasync function fetchJSON<T>(url: string, revalidateSeconds?: number): Promise<T> {\r\n  const options: RequestInit & { next?: { revalidate?: number } } = revalidateSeconds\r\n    ? { cache: 'force-cache', next: { revalidate: revalidateSeconds } }\r\n    : { cache: 'no-store' };\r\n\r\n  const res = await fetch(url, options);\r\n  if (!res.ok) {\r\n    const text = await res.text().catch(() => '');\r\n    throw new Error(`Fetch failed ${res.status}: ${text}`);\r\n  }\r\n  return (await res.json()) as T;\r\n}\r\n\r\nexport { fetchJSON };\r\n\r\nexport async function getNews(symbols?: string[]): Promise<MarketNewsArticle[]> {\r\n  try {\r\n    const range = getDateRange(5);\r\n    const token = FINNHUB_API_KEY;\r\n    \r\n    const cleanSymbols = (symbols || [])\r\n      .map((s) => s?.trim().toUpperCase())\r\n      .filter((s): s is string => Boolean(s));\r\n\r\n    const maxArticles = 6;\r\n\r\n    // If we have symbols, try to fetch company news per symbol and round-robin select\r\n    if (cleanSymbols.length > 0) {\r\n      const perSymbolArticles: Record<string, RawNewsArticle[]> = {};\r\n\r\n      await Promise.all(\r\n        cleanSymbols.map(async (sym) => {\r\n          try {\r\n            const url = `${FINNHUB_BASE_URL}/company-news?symbol=${encodeURIComponent(sym)}&from=${range.from}&to=${range.to}&token=${token}`;\r\n            const articles = await fetchJSON<RawNewsArticle[]>(url, 300);\r\n            perSymbolArticles[sym] = (articles || []).filter(validateArticle);\r\n          } catch (e) {\r\n            console.error('Error fetching company news for', sym, e);\r\n            perSymbolArticles[sym] = [];\r\n          }\r\n        })\r\n      );\r\n\r\n      const collected: MarketNewsArticle[] = [];\r\n      // Round-robin up to 6 picks\r\n      for (let round = 0; round < maxArticles; round++) {\r\n        for (let i = 0; i < cleanSymbols.length; i++) {\r\n          const sym = cleanSymbols[i];\r\n          const list = perSymbolArticles[sym] || [];\r\n          if (list.length === 0) continue;\r\n          const article = list.shift();\r\n          if (!article || !validateArticle(article)) continue;\r\n          collected.push(formatArticle(article, true, sym, round));\r\n          if (collected.length >= maxArticles) break;\r\n        }\r\n        if (collected.length >= maxArticles) break;\r\n      }\r\n\r\n      if (collected.length > 0) {\r\n        // Sort by datetime desc\r\n        collected.sort((a, b) => (b.datetime || 0) - (a.datetime || 0));\r\n        return collected.slice(0, maxArticles);\r\n      }\r\n      // If none collected, fall through to general news\r\n    }\r\n\r\n    // General market news fallback or when no symbols provided\r\n    const generalUrl = `${FINNHUB_BASE_URL}/news?category=general&token=${token}`;\r\n    const general = await fetchJSON<RawNewsArticle[]>(generalUrl, 300);\r\n\r\n    const seen = new Set<string>();\r\n    const unique: RawNewsArticle[] = [];\r\n    for (const art of general || []) {\r\n      if (!validateArticle(art)) continue;\r\n      const key = `${art.id}-${art.url}-${art.headline}`;\r\n      if (seen.has(key)) continue;\r\n      seen.add(key);\r\n      unique.push(art);\r\n      if (unique.length >= 20) break; // cap early before final slicing\r\n    }\r\n\r\n    const formatted = unique.slice(0, maxArticles).map((a, idx) => formatArticle(a, false, undefined, idx));\r\n    return formatted;\r\n  } catch (err) {\r\n    console.error('getNews error:', err);\r\n    throw new Error('Failed to fetch news');\r\n  }\r\n}\r\n\r\nexport async function searchStocks(query?: string): Promise<StockWithWatchlistStatus[]> {\r\n  try {\r\n    const token = process.env.FINNHUB_API_KEY ?? FINNHUB_API_KEY;\r\n    if (!token) {\r\n      // If no token, log and return empty to avoid throwing per requirements\r\n      console.error('Error in stock search:', new Error('FINNHUB API key is not configured'));\r\n      return [];\r\n    }\r\n\r\n    const trimmed = typeof query === 'string' ? query.trim() : '';\r\n\r\n    let results: FinnhubSearchResult[] = [];\r\n\r\n    if (!trimmed) {\r\n      // Fetch top 10 popular symbols' profiles\r\n      const top = POPULAR_STOCK_SYMBOLS.slice(0, 10);\r\n      const profiles = await Promise.all(\r\n        top.map(async (sym) => {\r\n          try {\r\n            const url = `${FINNHUB_BASE_URL}/stock/profile2?symbol=${encodeURIComponent(sym)}&token=${token}`;\r\n            // Revalidate every hour\r\n            const profile = await fetchJSON<any>(url, 3600);\r\n            return { sym, profile } as { sym: string; profile: any };\r\n          } catch (e) {\r\n            console.error('Error fetching profile2 for', sym, e);\r\n            return { sym, profile: null } as { sym: string; profile: any };\r\n          }\r\n        })\r\n      );\r\n\r\n      results = profiles\r\n        .map(({ sym, profile }) => {\r\n          const symbol = sym.toUpperCase();\r\n          const name: string | undefined = profile?.name || profile?.ticker || undefined;\r\n          const exchange: string | undefined = profile?.exchange || undefined;\r\n          if (!name) return undefined;\r\n          const r: FinnhubSearchResult = {\r\n            symbol,\r\n            description: name,\r\n            displaySymbol: symbol,\r\n            type: 'Common Stock',\r\n          };\r\n          // We don't include exchange in FinnhubSearchResult type, so carry via mapping later using profile\r\n          // To keep pipeline simple, attach exchange via closure map stage\r\n          // We'll reconstruct exchange when mapping to final type\r\n          (r as any).__exchange = exchange; // internal only\r\n          return r;\r\n        })\r\n        .filter((x): x is FinnhubSearchResult => Boolean(x));\r\n    } else {\r\n      const url = `${FINNHUB_BASE_URL}/search?q=${encodeURIComponent(trimmed)}&token=${token}`;\r\n      const data = await fetchJSON<FinnhubSearchResponse>(url, 1800);\r\n      results = Array.isArray(data?.result) ? data.result : [];\r\n    }\r\n\r\n    const mapped: StockWithWatchlistStatus[] = results\r\n      .map((r) => {\r\n        const upper = (r.symbol || '').toUpperCase();\r\n        const name = r.description || upper;\r\n        const exchangeFromDisplay = (r.displaySymbol as string | undefined) || undefined;\r\n        const exchangeFromProfile = (r as any).__exchange as string | undefined;\r\n        const exchange = exchangeFromDisplay || exchangeFromProfile || 'US';\r\n        const type = r.type || 'Stock';\r\n        const item: StockWithWatchlistStatus = {\r\n          symbol: upper,\r\n          name,\r\n          exchange,\r\n          type,\r\n          isInWatchlist: false,\r\n        };\r\n        return item;\r\n      })\r\n      .slice(0, 15);\r\n\r\n    return mapped;\r\n  } catch (err) {\r\n    console.error('Error in stock search:', err);\r\n    return [];\r\n  }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/lib/actions/finnhub.actions.ts b/lib/actions/finnhub.actions.ts
--- a/lib/actions/finnhub.actions.ts	(revision 6a0ea9864b7851ade9aa670f1c8bc78990b854a1)
+++ b/lib/actions/finnhub.actions.ts	(date 1771353021472)
@@ -154,9 +154,8 @@
       .map((r) => {
         const upper = (r.symbol || '').toUpperCase();
         const name = r.description || upper;
-        const exchangeFromDisplay = (r.displaySymbol as string | undefined) || undefined;
         const exchangeFromProfile = (r as any).__exchange as string | undefined;
-        const exchange = exchangeFromDisplay || exchangeFromProfile || 'US';
+        const exchange = exchangeFromProfile || 'US';
         const type = r.type || 'Stock';
         const item: StockWithWatchlistStatus = {
           symbol: upper,
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"AutoImportSettings\">\r\n    <option name=\"autoReloadType\" value=\"SELECTIVE\" />\r\n  </component>\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"ac167f20-5896-423a-b6b7-43f61c817fdc\" name=\"Changes\" comment=\"\">\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/lib/actions/finnhub.actions.ts\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/lib/actions/finnhub.actions.ts\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/lib/actions/user.actions.ts\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/lib/actions/user.actions.ts\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/lib/inngest/functions.ts\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/lib/inngest/functions.ts\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/lib/utils.ts\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/lib/utils.ts\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/test-db.ts\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/test-db.ts\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/types/global.d.ts\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/types/global.d.ts\" afterDir=\"false\" />\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"EmbeddingIndexingInfo\">\r\n    <option name=\"cachedIndexableFilesCount\" value=\"68\" />\r\n    <option name=\"fileBasedEmbeddingIndicesEnabled\" value=\"true\" />\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n  </component>\r\n  <component name=\"McpProjectServerCommands\">\r\n    <commands />\r\n    <urls />\r\n  </component>\r\n  <component name=\"ProjectColorInfo\">{\r\n  &quot;customColor&quot;: &quot;&quot;,\r\n  &quot;associatedIndex&quot;: 8\r\n}</component>\r\n  <component name=\"ProjectId\" id=\"39a8wM5pJNil64uJbVakycJtiQt\" />\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\"><![CDATA[{\r\n  \"keyToString\": {\r\n    \"ModuleVcsDetector.initialDetectionPerformed\": \"true\",\r\n    \"RunOnceActivity.MCP Project settings loaded\": \"true\",\r\n    \"RunOnceActivity.ShowReadmeOnStart\": \"true\",\r\n    \"RunOnceActivity.TerminalTabsStorage.copyFrom.TerminalArrangementManager.252\": \"true\",\r\n    \"RunOnceActivity.git.unshallow\": \"true\",\r\n    \"RunOnceActivity.typescript.service.memoryLimit.init\": \"true\",\r\n    \"com.intellij.ml.llm.matterhorn.ej.ui.settings.DefaultModelSelectionForGA.v1\": \"true\",\r\n    \"git-widget-placeholder\": \"daily-summary\",\r\n    \"js.debugger.nextJs.config.created.client\": \"true\",\r\n    \"js.debugger.nextJs.config.created.server\": \"true\",\r\n    \"junie.onboarding.icon.badge.shown\": \"true\",\r\n    \"node.js.detected.package.eslint\": \"true\",\r\n    \"node.js.detected.package.tslint\": \"true\",\r\n    \"node.js.selected.package.eslint\": \"(autodetect)\",\r\n    \"node.js.selected.package.tslint\": \"(autodetect)\",\r\n    \"nodejs_package_manager_path\": \"npm\",\r\n    \"to.speed.mode.migration.done\": \"true\",\r\n    \"ts.external.directory.path\": \"C:\\\\Users\\\\Michael Mitchell\\\\OneDrive\\\\Desktop\\\\stock\\\\node_modules\\\\typescript\\\\lib\",\r\n    \"vue.rearranger.settings.migration\": \"true\"\r\n  }\r\n}]]></component>\r\n  <component name=\"RunManager\" selected=\"npm.Next.js: server-side\">\r\n    <configuration name=\"Next.js: debug client-side\" type=\"JavascriptDebugType\" uri=\"http://localhost:3000/\">\r\n      <method v=\"2\" />\r\n    </configuration>\r\n    <configuration name=\"Next.js: server-side\" type=\"js.build_tools.npm\">\r\n      <package-json value=\"$PROJECT_DIR$/package.json\" />\r\n      <command value=\"run\" />\r\n      <scripts>\r\n        <script value=\"dev\" />\r\n      </scripts>\r\n      <node-interpreter value=\"project\" />\r\n      <envs />\r\n      <method v=\"2\" />\r\n    </configuration>\r\n  </component>\r\n  <component name=\"SharedIndexes\">\r\n    <attachedChunks>\r\n      <set>\r\n        <option value=\"bundled-js-predefined-d6986cc7102b-9b0f141eb926-JavaScript-WS-253.30387.83\" />\r\n      </set>\r\n    </attachedChunks>\r\n  </component>\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"ac167f20-5896-423a-b6b7-43f61c817fdc\" name=\"Changes\" comment=\"\" />\r\n      <created>1770923061090</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1770923061090</updated>\r\n      <workItem from=\"1770923063348\" duration=\"922000\" />\r\n      <workItem from=\"1771176511680\" duration=\"435000\" />\r\n      <workItem from=\"1771351639546\" duration=\"1010000\" />\r\n    </task>\r\n    <servers />\r\n  </component>\r\n  <component name=\"TypeScriptGeneratedFilesManager\">\r\n    <option name=\"version\" value=\"3\" />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision 6a0ea9864b7851ade9aa670f1c8bc78990b854a1)
+++ b/.idea/workspace.xml	(date 1771353269840)
@@ -7,11 +7,7 @@
     <list default="true" id="ac167f20-5896-423a-b6b7-43f61c817fdc" name="Changes" comment="">
       <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/lib/actions/finnhub.actions.ts" beforeDir="false" afterPath="$PROJECT_DIR$/lib/actions/finnhub.actions.ts" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/lib/actions/user.actions.ts" beforeDir="false" afterPath="$PROJECT_DIR$/lib/actions/user.actions.ts" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/lib/inngest/functions.ts" beforeDir="false" afterPath="$PROJECT_DIR$/lib/inngest/functions.ts" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/lib/utils.ts" beforeDir="false" afterPath="$PROJECT_DIR$/lib/utils.ts" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/test-db.ts" beforeDir="false" afterPath="$PROJECT_DIR$/test-db.ts" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/types/global.d.ts" beforeDir="false" afterPath="$PROJECT_DIR$/types/global.d.ts" afterDir="false" />
     </list>
     <option name="SHOW_DIALOG" value="false" />
     <option name="HIGHLIGHT_CONFLICTS" value="true" />
@@ -47,7 +43,7 @@
     "RunOnceActivity.git.unshallow": "true",
     "RunOnceActivity.typescript.service.memoryLimit.init": "true",
     "com.intellij.ml.llm.matterhorn.ej.ui.settings.DefaultModelSelectionForGA.v1": "true",
-    "git-widget-placeholder": "daily-summary",
+    "git-widget-placeholder": "Merging daily-summary",
     "js.debugger.nextJs.config.created.client": "true",
     "js.debugger.nextJs.config.created.server": "true",
     "junie.onboarding.icon.badge.shown": "true",
@@ -92,7 +88,7 @@
       <updated>1770923061090</updated>
       <workItem from="1770923063348" duration="922000" />
       <workItem from="1771176511680" duration="435000" />
-      <workItem from="1771351639546" duration="1010000" />
+      <workItem from="1771351639546" duration="1617000" />
     </task>
     <servers />
   </component>
Index: lib/inngest/functions.ts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import {inngest} from \"@/lib/inngest/client\";\r\nimport {NEWS_SUMMARY_EMAIL_PROMPT, PERSONALIZED_WELCOME_EMAIL_PROMPT} from \"@/lib/inngest/prompts\";\r\nimport {sendNewsSummaryEmail, sendWelcomeEmail} from \"@/lib/nodemailer\";\r\nimport {getAllUsersForNewsEmail} from \"@/lib/actions/user.actions\";\r\nimport { getWatchlistSymbolsByEmail } from \"@/lib/actions/watchlist.actions\";\r\nimport { getNews } from \"@/lib/actions/finnhub.actions\";\r\nimport { getFormattedTodayDate } from \"@/lib/utils\";\r\n\r\nexport const sendSignUpEmail = inngest.createFunction(\r\n    { id: 'sign-up-email' },\r\n    { event: 'app/user.created'},\r\n    async ({ event, step }) => {\r\n        const userProfile = `\r\n            - Country: ${event.data.country}\r\n            - Investment goals: ${event.data.investmentGoals}\r\n            - Risk tolerance: ${event.data.riskTolerance}\r\n            - Preferred industry: ${event.data.preferredIndustry}\r\n        `\r\n\r\n        const prompt = PERSONALIZED_WELCOME_EMAIL_PROMPT.replace('{{userProfile}}', userProfile)\r\n\r\n        const response = await step.ai.infer('generate-welcome-intro', {\r\n            model: step.ai.models.gemini({ model: 'gemini-2.5-flash-lite' }),\r\n            body: {\r\n                contents: [\r\n                    {\r\n                        role: 'user',\r\n                        parts: [\r\n                            { text: prompt }\r\n                        ]\r\n                    }]\r\n            }\r\n        })\r\n\r\n        await step.run('send-welcome-email', async () => {\r\n            const part = response.candidates?.[0]?.content?.parts?.[0];\r\n            const introText = (part && 'text' in part ? part.text : null) ||'Thanks for joining Signalist. You now have the tools to track markets and make smarter moves.'\r\n\r\n            const { data: { email, name } } = event;\r\n\r\n            return await sendWelcomeEmail({ email, name, intro: introText });\r\n        })\r\n\r\n        return {\r\n            success: true,\r\n            message: 'Welcome email sent successfully'\r\n        }\r\n    }\r\n)\r\n\r\nexport const sendDailyNewsSummary = inngest.createFunction(\r\n    { id: 'daily-news-summary' },\r\n    [ { event: 'app/send.daily.news' }, { cron: '0 12 * * *' } ],\r\n    async ({ step }) => {\r\n        // Step #1: Get all users for news delivery\r\n        const users = await step.run('get-all-users', getAllUsersForNewsEmail)\r\n\r\n        if(!users || users.length === 0) return { success: false, message: 'No users found for news email' };\r\n\r\n        // Step #2: For each user, get watchlist symbols -> fetch news (fallback to general)\r\n        const results = await step.run('fetch-user-news', async () => {\r\n            const perUser: Array<{ user: UserForNewsEmail; articles: MarketNewsArticle[] }> = [];\r\n            for (const user of users) {\r\n                try {\r\n                    const symbols = await getWatchlistSymbolsByEmail(user.email);\r\n                    let articles = await getNews(symbols);\r\n                    // Enforce max 6 articles per user\r\n                    articles = (articles || []).slice(0, 6);\r\n                    // If still empty, fallback to general\r\n                    if (!articles || articles.length === 0) {\r\n                        articles = await getNews();\r\n                        articles = (articles || []).slice(0, 6);\r\n                    }\r\n                    perUser.push({ user, articles });\r\n                } catch (e) {\r\n                    console.error('daily-news: error preparing user news', user.email, e);\r\n                    perUser.push({ user, articles: [] });\r\n                }\r\n            }\r\n            return perUser;\r\n        });\r\n\r\n        // Step #3: (placeholder) Summarize news via AI\r\n        const userNewsSummaries: { user: UserForNewsEmail; newsContent: string | null }[] = [];\r\n\r\n        for (const { user, articles } of results) {\r\n                try {\r\n                    const prompt = NEWS_SUMMARY_EMAIL_PROMPT.replace('{{newsData}}', JSON.stringify(articles, null, 2));\r\n\r\n                    const response = await step.ai.infer(`summarize-news-${user.email}`, {\r\n                        model: step.ai.models.gemini({ model: 'gemini-2.5-flash-lite' }),\r\n                        body: {\r\n                            contents: [{ role: 'user', parts: [{ text:prompt }]}]\r\n                        }\r\n                    });\r\n\r\n                    const part = response.candidates?.[0]?.content?.parts?.[0];\r\n                    const newsContent = (part && 'text' in part ? part.text : null) || 'No market news.'\r\n\r\n                    userNewsSummaries.push({ user, newsContent });\r\n                } catch (e) {\r\n                    console.error('Failed to summarize news for : ', user.email);\r\n                    userNewsSummaries.push({ user, newsContent: null });\r\n                }\r\n            }\r\n\r\n        // Step #4: (placeholder) Send the emails\r\n        await step.run('send-news-emails', async () => {\r\n                await Promise.all(\r\n                    userNewsSummaries.map(async ({ user, newsContent}) => {\r\n                        if(!newsContent) return false;\r\n\r\n                         return await sendNewsSummaryEmail({ email: user.email, date: getFormattedTodayDate(), newsContent })\r\n                    })\r\n                )\r\n            })\r\n\r\n        return { success: true, message: 'Daily news summary emails sent successfully' }\r\n    }\r\n)
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/lib/inngest/functions.ts b/lib/inngest/functions.ts
--- a/lib/inngest/functions.ts	(revision 6a0ea9864b7851ade9aa670f1c8bc78990b854a1)
+++ b/lib/inngest/functions.ts	(date 1771353183395)
@@ -4,7 +4,7 @@
 import {getAllUsersForNewsEmail} from "@/lib/actions/user.actions";
 import { getWatchlistSymbolsByEmail } from "@/lib/actions/watchlist.actions";
 import { getNews } from "@/lib/actions/finnhub.actions";
-import { getFormattedTodayDate } from "@/lib/utils";
+import { formatDateToday } from "@/lib/utils";
 
 export const sendSignUpEmail = inngest.createFunction(
     { id: 'sign-up-email' },
@@ -60,7 +60,7 @@
         // Step #2: For each user, get watchlist symbols -> fetch news (fallback to general)
         const results = await step.run('fetch-user-news', async () => {
             const perUser: Array<{ user: UserForNewsEmail; articles: MarketNewsArticle[] }> = [];
-            for (const user of users) {
+            for (const user of users as UserForNewsEmail[]) {
                 try {
                     const symbols = await getWatchlistSymbolsByEmail(user.email);
                     let articles = await getNews(symbols);
@@ -110,7 +110,7 @@
                     userNewsSummaries.map(async ({ user, newsContent}) => {
                         if(!newsContent) return false;
 
-                         return await sendNewsSummaryEmail({ email: user.email, date: getFormattedTodayDate(), newsContent })
+                        return await sendNewsSummaryEmail({ email: user.email, date: formatDateToday, newsContent })
                     })
                 )
             })
